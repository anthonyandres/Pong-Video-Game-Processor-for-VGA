# Pong Video Game Processor for VGA


![pong image](https://github.com/anthonyandres/Pong-Video-Game-Processor-for-VGA/blob/main/SVGP/VGAPongDemo.jpg)


## Preface
VGA, otherwise referred to as Video Graphics Array or Video Graphics Adapter, is a video adapter standard developed by IBM in 1987. VGA involves the use of a female and male connection of a 15 pin adapter, the DE15 adapter. The five pins of interest in this project include the three colour pins, red, green, and blue, and two signals for video synchronization, HSync and VSync. 

The goal of this project was to learn and understand video-output and VGA functionality. It involves the implementation of a simple video game processor for VGA standard as well as I/O device interfacing for the Spartan-3E FPGA board. Additionally, the project allowed for hands-on experience with the on-board circuitry as well as other external hardware or I/O devices in the form of a VGA video monitor.

The project was done in the Xilinx ISE CAD environment using VHDL coding techniques. The VHDL program implemented the key components required for the provided VGA parameters as well as for the proper images reflected on the VGA monitor. A 25MHz clock was derived from the 50MHz oscillator found on the Spartan-3E board. The derived clock signal was used to ensure a 60Hz refresh rate on the monitor. HSync and VSync were also determined with the given parameters, and the necessary colours, graphics, and functionality of the simple game were determined within the program.

The VHDL program was used to program the Spartan-3E board, which was used to display onto the VGA program, as well as act as the game controller for the players using the on-board switches. In conclusion, the implementation of the simple game allowed for sufficient experience to understand how the VGA standard is used to adapt signals onto VGA monitors. The use of FPGA boards and hardware assisted in the process of understanding video-output and VGA functionality.

## Introduction

The simple video game implemented in this project is a simplified version of the well-known game “pong” developed by Atari. This implementation consists of two different dynamic elements. First, two players can each control a paddle, one blue and one magenta, using the on-board switches, SW1 and SW0. Players can move the switches up to move the paddle up and down to move the paddles down. The second dynamic element was the yellow ball that moves across the screen changing its velocity accordingly as it hits different areas of the screen. Furthermore, as the ball enters the gate on either left or right side of the screen, the colour of the ball changes from yellow to red and disappears. The ball reappears shortly after in the centre of the screen. The x and y pixel position of each dynamic element was tracked in order to determine their interaction with one another. For instance, the collision of a player paddle and the ball is determined by the coordinates of each element, which can be moving depending on different conditions.

The entire vertical and horizontal pixel area was kept track of using a count of both the vertical and horizontal pixel position, resetting the count according to the provided VGA parameters in Table 2 and Table 3. From the horizontal and vertical pixel count, the HSync and VSync signals could be determined. Additionally, the pixel count was used as reference for determining the colours to be displayed to “build” the non-dynamic elements of the screen which include the green background as well as the white border. The dynamic elements were also built on the screen using their tracked coordinates in conjunction with the horizontal and vertical pixel trackers. Colours were addressed in three different 8-bit arrays for the red, green, and blue signals. The 8-bit digital signals were converted to analog signals by interfacing them to the Spartan-3E board.

### Port Mapping
The following tables display the signals generated by either the Spartan-3E board or the VHDL program in order for implementation of the simple video game and its display on a VGA monitor. 

Table 1. Signals generated by the Spartan-3E board, used by the VHDL program
| **Signals Outputted by Spartan-3E** | **Pin location on Spartan-3E** | 
| ----------------------------------- | ------------------------------ |
|       50MHz clock signal (clk)      |               c9               | 
|            Switch 0 (SW0)           |               L13              | 
|            Switch 1 (SW1)           |               L14              | 
|            Switch 2 (SW2)           |               H18              | 
|            Switch 3 (SW3)           |               N17              | 



Table 2. Signals generated by the VHDL program, used by the Spartan-3E board for VGA video output
|  **Signals Inputted into Spartan-3E**   | **Pin location on Spartan-3E** |
| --------------------------------------- | -------------------------------------- |
|            HSync Signal (H)             |                   c5                   | 
|            VSync Signal (V)             |                   d5                   | 
|      25MHz clock signal (DAC_CLK)       |                   a4                   | 
|  Red colour channel (Rout[7 downto 0])  | b16, a16, d14, c14, b14, a14, b13, a13 | 
| Green colour channel (Gout[7 downto 0]) | f9, e9, d11, c11, f11, e11, e12, f12   |
| Blue colour channel (Bout[7 downto 0])  |     a6, b6, e7, f7, d7, c7, f8, e8     |


### VGA Specifications
The following VGA parameters provide the “size” of pixel dimensions to be kept track of. One period of the clock addresses one pixel on the screen, so the above parameters can also be considered the number of pixels needed to be addressed for each portion of the video image.

Table 3. Horizontal VGA Parameters
|    **Parameter**   | **Clock Cycles** | 
| ------------------ | ---------------- |
|    Complete Line   |        800       | 
|     Front Porch    |        16        | 
|     Sync Pulse     |        96        | 
|     Back Porch     |        48        | 
| Display Image Area |        640       | 


Table 4. Vertical VGA Parameters
|    **Parameter**   | **Clock Cycles** | 
| ------------------ | ---------------- |
|    Complete Line   |        525       | 
|     Front Porch    |        10        | 
|     Sync Pulse     |        2         | 
|     Back Porch     |        33        | 
| Display Image Area |        480       |

### Timing Diagrams

![timing1](https://github.com/anthonyandres/Pong-Video-Game-Processor-for-VGA/blob/main/SVGP/50MHz%20clock%20(top)%20and%2025MHz%20clock%20(bottom).png)
Timing diagram showcasing 50Mhz on board clock signal “clk” and derived 25MHz clock signal “DAC_CLOCK”

![timing2](https://github.com/anthonyandres/Pong-Video-Game-Processor-for-VGA/blob/main/SVGP/hsync%20occurs%20at%2013us.png)
First HSync “H” active low signal occurs at time 13,050 ns, period between HSync signals is 16us

![timing3](https://github.com/anthonyandres/Pong-Video-Game-Processor-for-VGA/blob/main/SVGP/vsync%20occurs%20at%207824.png)
First VSync “V” active low signal occurs at time 7824us. 7824/16 = 489 ~=480. 480 is the number of horizontal retraces or HSync signals that need to occur before vertical retrace or a VSync signal occurs.

## Code Breakdown
I will include a walkthrough of the various .vhd files such as the [pong.vhd](https://github.com/anthonyandres/Pong-Video-Game-Processor-for-VGA/blob/main/SVGP/SVGP/pong.vhd) file where a majority of the game logic occurs


